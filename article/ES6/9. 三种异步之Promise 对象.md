# Promise 对象

## 含义

**Promise 是异步编程的一种解决方案**，在 `Promise` 之前，采用的是回调函数和事件，但是会存在一些问题，像回调地狱。而在 ES6 中，提供了 `Promise` 对象。

`Promise` 简单来讲，其实就是一个容器，用来存储异步事件（例如网络请求等）。

语法上来说，`Promise` 是一个对象，可以获取异步操作的消息。

### 主要特点

- 对象状态不受外界影响。
  - 一共只有三种状态：`pending` （进行中）、`fulfilled`（完成）和 `rejected`（失败）。只受异步操作的结果，可以决定当前是哪种状态，其他任何操作都无法改变这个状态。
- 一旦状态改变，就不能再变，任何时候都可以得到这个结果。
  - Promise 对象状态改变只有两种可能性，从`pending` 到 `fulfilled` 和从 `pending` 到 `rejected`。

### 主要缺陷

- 一旦创建会立即执行，无法中途取消。
- 如果内部不设置回调函数，外部是不能知道内部情况的。
- 当状态处于 `pending` 时，无法得知目前进展到哪个阶段。

## 基本用法

这里一般需要进行异步操作，但是为了学习方便，我们直接同步进行了。
`Promise` 构造函数接受一个函数作为参数，该函数的参数为 `resolve` 和 `reject`。 `resolve` 和 `reject` 是两个函数，有 JS 引擎提供，不需要自己部署。
`resolve` 函数作用是将 `Promise` 的状态从 `pending` 变为 `resolved`，并且将操作结果作为参数传递出去。
`reject` 函数作用是将 `Promise` 的状态从 `pending` 变为 `rejected`，并且将错误信息传递出去。
`Promise` 生成实例之后，可以调用 `then` 方法，其中包含两个函数参数。第一个函数包含 `resolved` 状态的结果，第二个包含 `rejected` 状态结果。两个函数都是可选参数。

我们将 `flag` 比做异步操作，`true` 表示异步成功，`false` 表示异步失败。

```javascript
const promise = new Promise((resolve, reject) => {
  let flag = true;
  if (flag) {
    resolve('操作成功');
  } else {
    reject('操作失败');
  }
});
promise.then(
  (value) => {
    console.log('value = ', value);
  },
  (error) => {
    console.log('error = ', error);
  }
);
```

从上面的代码来看，`flag` 为 `true` 时，会打印 `value = 操作成功`，为 false 时，打印 `error = 操作失败`。

我们来看看 `then` 的异步。
在 `Promise` 创建时，就会立即执行，而 `then` 会在当前脚本所有同步任务执行完才会执行。

```javascript
const promise = new Promise((resolve, reject) => {
  console.log('1');
  resolve('2');
});
promise.then((val) => {
  console.log(val);
});
console.log('3');
// '1'
// '3'
// '2'
```

## 实例方法

### Promise.prototype.then()

### Promise.prototype.catch()

### Promise.prototype.finally()

## Promise.all()

## Promise.race()

## Promsie.allSettled()

## Promise.any()

## Promise.resolved()

## Promise.reject()
